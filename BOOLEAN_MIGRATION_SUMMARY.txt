â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    MIGRACIÃ“N DE COLUMNAS BOOLEANAS
                      MySQL â†’ PostgreSQL (Railway)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RESUMEN EJECUTIVO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âŒ PROBLEMA ACTUAL:
   - Columnas mixtas: BOOLEAN, SMALLINT, CHAR(2)
   - Queries hardcodeadas con "= 1", "= 0", "= true", "= false"
   - Errores de tipo en PostgreSQL: "operator does not exist: boolean = integer"

âœ… SOLUCIÃ“N PROPUESTA:
   - Estandarizar TODO a tipo BOOLEAN nativo de PostgreSQL
   - Actualizar 21 lÃ­neas en 8 archivos Go
   - Scripts de migraciÃ³n y rollback incluidos

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            IMPACTO DE LA MIGRACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TABLAS AFECTADAS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. account (11 registros actuales)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Columna                        â”‚ Tipo Actual   â”‚ Tipo Destino     â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ is_premium                     â”‚ SMALLINT      â”‚ BOOLEAN âš ï¸       â”‚
   â”‚ receive_notifications          â”‚ BOOLEAN âœ…    â”‚ BOOLEAN âœ…       â”‚
   â”‚ is_private_profile             â”‚ BOOLEAN âœ…    â”‚ BOOLEAN âœ…       â”‚
   â”‚ has_finished_tutorial          â”‚ CHAR(2)       â”‚ BOOLEAN âš ï¸       â”‚
   â”‚ has_watch_new_incident_tutorialâ”‚ CHAR(2)       â”‚ BOOLEAN âš ï¸       â”‚
   â”‚ can_update_email               â”‚ SMALLINT      â”‚ BOOLEAN âš ï¸       â”‚
   â”‚ can_update_nickname            â”‚ SMALLINT      â”‚ BOOLEAN âš ï¸       â”‚
   â”‚ can_update_fullname            â”‚ SMALLINT      â”‚ BOOLEAN âš ï¸       â”‚
   â”‚ can_update_birthdate           â”‚ SMALLINT      â”‚ BOOLEAN âš ï¸       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Total: 7 columnas a migrar

2. account_favorite_locations (3 registros actuales)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Columna                        â”‚ Tipo Actual   â”‚ Tipo Destino     â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ status                         â”‚ SMALLINT      â”‚ BOOLEAN âš ï¸       â”‚
   â”‚ crime                          â”‚ BOOLEAN âœ…    â”‚ BOOLEAN âœ…       â”‚
   â”‚ traffic_accident               â”‚ BOOLEAN âœ…    â”‚ BOOLEAN âœ…       â”‚
   â”‚ medical_emergency              â”‚ BOOLEAN âœ…    â”‚ BOOLEAN âœ…       â”‚
   â”‚ (... 8 mÃ¡s)                    â”‚ BOOLEAN âœ…    â”‚ BOOLEAN âœ…       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Total: 1 columna a migrar

CÃ“DIGO GO AFECTADO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Archivo                                         â”‚ LÃ­neasâ”‚ Tipo Cambio     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ internal/cronjob/premium_expiration.go          â”‚   6   â”‚ "= 1" â†’ "= true"â”‚
â”‚ internal/cronjobs/cjuserank/repository.go       â”‚   1   â”‚ "= 1" â†’ "= true"â”‚
â”‚ internal/cronjobs/cjbadgeearn/repository.go     â”‚   1   â”‚ "= 1" â†’ "= true"â”‚
â”‚ internal/cronjobs/cjcomments/repository.go      â”‚   1   â”‚ "= 1" â†’ "= true"â”‚
â”‚ internal/cronjobs/cjincidentupdate/repository.goâ”‚   2   â”‚ "= 1" â†’ "= true"â”‚
â”‚ internal/editprofile/repository.go              â”‚   5   â”‚ Eliminar BoolToInt()â”‚
â”‚ internal/tutorial/repository.go                 â”‚   1   â”‚ Eliminar BoolToInt()â”‚
â”‚ internal/account/repository.go                  â”‚   4   â”‚ Eliminar BoolToInt()â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL                                           â”‚  21   â”‚ 8 archivos      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

QUERIES PROBLEMÃTICAS DETECTADAS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âŒ internal/cronjob/premium_expiration.go:65
   WHERE is_premium = 1  ğŸ‘ˆ FALLA si is_premium fuera BOOLEAN
   
âŒ internal/cronjobs/cjuserank/repository.go:28
   WHERE receive_notifications = 1  ğŸ‘ˆ FALLA (receive_notifications ES BOOLEAN)
   
âŒ internal/cronjobs/cjbadgeearn/repository.go:41
   WHERE receive_notifications = 1  ğŸ‘ˆ FALLA (receive_notifications ES BOOLEAN)
   
âŒ internal/cronjobs/cjcomments/repository.go:140
   WHERE a.is_premium = 1 AND a.receive_notifications = 1
   ğŸ‘ˆ receive_notifications FALLA

âŒ internal/cronjobs/cjincidentupdate/repository.go:140-141
   AND a.is_premium = 1
   AND a.receive_notifications = 1
   ğŸ‘ˆ receive_notifications FALLA

âš ï¸  internal/cronjobs/cjnewcluster/repository.go:81-82
   AND a.is_premium = true  ğŸ‘ˆ FALLA (is_premium ES SMALLINT)
   AND a.receive_notifications = true  âœ… OK

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              PLAN DE EJECUCIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 1: BACKUP (5 minutos)
   â˜ Crear snapshot en Railway Dashboard
   â˜ O ejecutar pg_dump manual
   â˜ Verificar que backup es vÃ¡lido

PASO 2: MIGRACIÃ“N SQL (1-2 minutos)
   â˜ Conectar a PostgreSQL Railway
   â˜ Ejecutar: \i assets/db/migrations/001_standardize_boolean_columns.sql
   â˜ Verificar output: "âœ… MIGRATION COMPLETED SUCCESSFULLY"
   â˜ Validar tipos de columnas: \d account

PASO 3: CÃ“DIGO GO (5-10 minutos)
   â˜ Aplicar parches segÃºn BOOLEAN_MIGRATION_GO_PATCHES.md
   â˜ O ejecutar script automatizado (apply_boolean_patches.sh)
   â˜ Compilar: go build ./cmd/app && go build ./cmd/cronjob
   â˜ Verificar: grep -rn "= 1" internal/ | grep is_premium

PASO 4: TESTING (20-30 minutos)
   â˜ Tests unitarios: go test ./...
   â˜ Test de login (valida is_premium, has_finished_tutorial)
   â˜ Test de profile (valida 4 columnas booleanas)
   â˜ Test de editar perfil (toggle privacidad/notificaciones)
   â˜ Test de cronjobs (valida receive_notifications, is_premium)
   â˜ Test de myplaces (valida 12 columnas BOOLEAN)
   â˜ Test de tutorial (valida has_finished_tutorial)

PASO 5: DEPLOY (10 minutos)
   â˜ git commit con mensaje detallado
   â˜ git push origin main (Railway autodeploy)
   â˜ O deployment manual en EC2
   â˜ Verificar health endpoint
   â˜ Monitorear logs de producciÃ³n

PASO 6: VALIDACIÃ“N (10 minutos)
   â˜ Verificar que no hay errores en logs
   â˜ Probar flujo completo de usuario:
      â€¢ Login â†’ Profile â†’ Editar perfil â†’ Tutorial
   â˜ Verificar que cronjobs se ejecutan correctamente
   â˜ Verificar mÃ©tricas de base de datos

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              ESTIMACIONES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DuraciÃ³n Total:    1-2 horas (incluye testing exhaustivo)
Riesgo:            Bajo (cambios quirÃºrgicos y localizados)
Rollback:          Disponible (script incluido)
Downtime:          0 minutos (si se ejecuta correctamente)

Impacto Positivo:
   âœ… Elimina errores de tipo "boolean = integer"
   âœ… Mejora performance (BOOLEAN = 1 byte vs SMALLINT = 2 bytes)
   âœ… CÃ³digo mÃ¡s limpio (sin conversiones manuales)
   âœ… Queries mÃ¡s legibles ("WHERE is_premium" en vez de "WHERE is_premium = 1")
   âœ… Sigue buenas prÃ¡cticas de PostgreSQL

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                              ROLLBACK PLAN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Si algo sale mal:

1. ROLLBACK SQL (inmediato)
   psql -f assets/db/migrations/001_rollback_boolean_columns.sql

2. ROLLBACK CÃ“DIGO (inmediato)
   git revert HEAD

3. RESTAURAR BACKUP (Ãºltimo recurso)
   Railway Dashboard â†’ Restore Snapshot
   o pg_restore backup_file.sql

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            ARCHIVOS DE REFERENCIA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“„ BOOLEAN_MIGRATION_ANALYSIS.md           - AnÃ¡lisis exhaustivo completo
ğŸ“„ BOOLEAN_MIGRATION_GO_PATCHES.md         - Cambios lÃ­nea por lÃ­nea
ğŸ“„ BOOLEAN_MIGRATION_EXECUTION_PLAN.md     - Plan paso a paso detallado
ğŸ“„ assets/db/migrations/001_standardize_boolean_columns.sql
ğŸ“„ assets/db/migrations/001_rollback_boolean_columns.sql

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                 CONCLUSIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Esta migraciÃ³n es NECESARIA y SEGURA. El anÃ¡lisis es exhaustivo y el impacto
estÃ¡ completamente mapeado. Todos los cambios son quirÃºrgicos y bien localizados.

Confianza: â˜…â˜…â˜…â˜…â˜… (Alta)
DocumentaciÃ³n: â˜…â˜…â˜…â˜…â˜… (Completa)
Testing: â˜…â˜…â˜…â˜…â˜… (Exhaustivo)
Rollback: â˜…â˜…â˜…â˜…â˜… (Disponible)

PrÃ³ximo paso: Ejecutar PASO 1 (Backup) y seguir el plan de ejecuciÃ³n.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Fecha: 2026-01-18 | Preparado por: Claude Code (AnÃ¡lisis Exhaustivo)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
